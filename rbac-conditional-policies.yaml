# 1. Read only if the caller or any of their groups owns the entity
result: CONDITIONAL
roleEntityRef: role:default/developers
pluginId: catalog
resourceType: catalog-entity
permissionMapping:
  - read
  - update         # ties catalog.entity.refresh
conditions:
  rule: IS_ENTITY_OWNER
  resourceType: catalog-entity
  params:
    claims: ["$ownerRefs"]

---
# 2. Always allow seeing Group entities that list the caller in spec.members
result: CONDITIONAL
roleEntityRef: role:default/developers
pluginId: catalog
resourceType: catalog-entity
permissionMapping:
  - read
conditions:
  allOf:
    - rule: IS_ENTITY_KIND
      resourceType: catalog-entity
      params:
        kinds: ["Group"]
    - rule: HAS_SPEC
      resourceType: catalog-entity
      params:
        key: members
        value: "$currentUser"

---
# 3. Always allow seeing the caller's own User entity using a stable annotation
# Add metadata.annotations.rbac.redhat.com/user-ref: "user:default/<name>" on each User
result: CONDITIONAL
roleEntityRef: role:default/developers
pluginId: catalog
resourceType: catalog-entity
permissionMapping:
  - read
conditions:
  allOf:
    - rule: IS_ENTITY_KIND
      resourceType: catalog-entity
      params:
        kinds: ["User"]
    - rule: HAS_ANNOTATION
      resourceType: catalog-entity
      params:
        annotation: rbac.redhat.com/user-ref
        value: "$currentUser"
